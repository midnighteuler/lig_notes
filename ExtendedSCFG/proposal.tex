\documentclass[11pt]{article}
\setlength{\topmargin}{-.5in}
\setlength{\textheight}{9in}
\setlength{\oddsidemargin}{.125in}
\setlength{\textwidth}{6.25in}

\usepackage{graphicx}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{proof}
\usepackage{algorithm}
\usepackage{algorithmic}
\usepackage{dsfont}
\usepackage{parsetree}
\usepackage{float} % for box around all figures
\usepackage{framed}
\usepackage{mathtools}
\floatstyle{boxed} 
\restylefloat{figure}

\begin{document}

\title{Extended SCFGs for LTR Identification}

\author{M.L. Souza\\
University of California Berkeley\\
Biophysics}

\renewcommand{\today}{August 22, 2011}
\maketitle
We consider slightly extended stochastic context-free grammars
for use in parsing languages of limited repeats.

\section {Overview}
Background
\section {Extending SCFGs}
Consider grammar $G \ = \ (N, \ S, \ T, \ P, \ \psi)$ \\
where $N$ are non-terminal symbols, $S \in N$ the start symbol, $T$ terminals, $P$ a set of production rules,
and $\psi$ the probability distribution over the production rules $P$.
\subsection {Production Rules}
In the following, let $n,m \in T$ be a terminal symbols, and $x,\ x' \in T^*$ be strings. \\
We form a superset of ``RNA normal form'' for SCFGs (Reference? Durbin?):
\begin{enumerate}
\item Bifurcation: $\ \ L \rightarrow R \ M$
\item Pass-through:$\ \ L \rightarrow R$
\item Left emission: $\ \ L \rightarrow n R$
\item Right emission: $\ \ L \rightarrow R n$
\item Paired emission: $\ \ L \rightarrow m R n$ 
\item Terminal emission: $\ \ L \rightarrow n$
\item Null emission: $\ \ L \rightarrow \epsilon$ 
\end{enumerate}
Adding an additional rule:
\begin{enumerate}
\setcounter{enumi}{7}
\item Repeat emission: $\ \ L \rightarrow R_\text{rep}(M)$
\end{enumerate}
Where $R_\text{rep}(M)$ is a distinguished non-terminal in which: $ L \rightarrow R_\text{rep}(M) \Leftrightarrow L \rightarrow x M x'$ \\
With $x, \ x' \in T^*$, and $x'$ an approximate-repeat of $x$, to be made more precise below.

\subsubsection {Repeat Emissions}
Non-terminals such as $R_\text{rep}(M)$ are an embedded constrained linear indexed grammar
defined by the following rules:
\begin{enumerate}
\item $\ \ R_\text{rep} \rightarrow X[]$
\item $\ \ X[\sigma] \rightarrow n X[\sigma \ n]$
\item $\ \ X[\sigma] \rightarrow X'[\sigma]$
\item $\ \ X'[\sigma n] \rightarrow X'[\sigma]m$
\item $\ \ X'[] \rightarrow M$
\end{enumerate}
The above rules define a grammar capable of generating the language:
\[
 L_\text{rep} = \left \{ xmx' \mid x,x',m \in T^* \right \}
\]
With $|w| = |w'|$ and each terminal $w_i$ dictating the probability of emitting symbol $w'_i$ for $0 \le i \le |w|$,
and m denoting the substring generated by the non-terminal $M$.\\
I.e. it generates repetitions of precisely the same length with pointwise mutations.\\ \\
We will show that parsing of an extended SCFG having repeat emissions as above can be performed in O($N^4$) time,
where $N$ is the length of the input string.\\ \\
We can extend the repeat grammar to allow insertions and deletions by introducing the following production rules:
\begin{enumerate}
\setcounter{enumi}{5}
\item $\ \ X'[\sigma n] \rightarrow X'[\sigma]$ (Popping a symbol off the stack; corresponds to a deletion)
\item $\ \ X'[\sigma] \rightarrow X'[\sigma]m$ (A right-emission without stack modification; corresponds to an insertion.)
\end{enumerate}
An important property of this grammar is that the growing stack for non-terminal $X$ is exactly the substring
which the grammar emitted.
\subsection {Parsing: Recursive Definition}
We now consider an extension of the CYK algorithm to determine the maximum-likelihood
parse for a given input string $s$. \\
We first give a recursive definition for each element of matrix $C \in \mathds{R}^{|s|} \times \mathds{R}^{|s|} \times N$.\\
Let $C(i, j - i + 1, S) = \displaystyle{\mathop{\mbox{max}}_{\substack{\text{parse trees} \ \pi \\ \text{deriving} \ x_{i \cdots j}}} P(\pi)}$ be defined as follows:
\[ 
C(i, j - i + 1, S) = \mbox{max}
  \begin{dcases}
      \mathop{\mbox{max}}_{R,M} \ \mathop{\mbox{max}}_{0 \le k \le j - i} \ C(i, k, R) C(i+k, j-k, M) P(L \rightarrow R M) \\
      \mathop{\mbox{max}}_{R} C(i, j-i, R) P(L \rightarrow R) \\
      \mathop{\mbox{max}}_{R} P(L \rightarrow n R) C(i+1, j-(i+1), R) \\
      \mathop{\mbox{max}}_{R} C(i, j-1, R) P(L \rightarrow R n) \\
      \mathop{\mbox{max}}_{R} P(L \rightarrow n R m) C(i+1, j-(i+2), R) \\
      P(L \rightarrow x_i) \\
      P(L \rightarrow \epsilon) \\
      f(i, j)\text{ defined below}\\
  \end{dcases}
\]
We consider $f(i, j)$ for two cases, with and without rules 6 \& 7 of the repeat SLIG defined above.

\subsubsection {Mutations, Insertions, and Deletions}
Let $x_{i \cdots j}$ be a substring of $x$ partitioned into three parts of arbitrary length: (Diagram would be nice here.)\\
\[
 x_{i \cdots j} = x_\text{lhs} x_\text{mid} x_\text{rhs}
\]
With $x_\text{lhs} = x_{i \cdots l-1}$, $x_\text{mid} = x_{l \cdots k-1}$, and $x_\text{rhs} = x_{k \cdots j}$.\\ \\
We seek to calculate the probability of generating $x_\text{lhs}, x_\text{rhs}$ with the embedded SLIG,
while generating $x_\text{mid}$ with its containing SCFG. \\ \\
The probability of the SLIG non-terminal $R_\text{rep}$ generating $x_\text{lhs}$ and the
containing SCFG non-terminal $M$ generating $x_\text{mid}$ are:
\[
 P(R_\text{rep} \Rightarrow x_\text{lhs}) = \prod_{m=i}^{l-1}P(X[\sigma] \rightarrow x_m X[\sigma x_m])
\]
\[
 P(M \Rightarrow x_\text{mid}) = P(X'[] \rightarrow M) C(l, k-l, M) 
\]
To calculate $P(X'[x_\text{lhs}] \Rightarrow x_\text{rhs})$, the probability of generating
$x_\text{rhs}$ allowing SLIG rules 4, 6, and 7 can be thought of as an alignment problem.
I.e. we can interpret $P(X'[\sigma x_m] \rightarrow X'[\sigma]x_n)$ as a match/mismatch score to
emit $x_n$ given $x_m$, $P(X'[\sigma] \rightarrow X'[\sigma]x_n)$ as insertion score to insert $x_n$,
and $P(X'[\sigma x_m] \rightarrow X'[\sigma])$ as deletion score to omit $x_m$ from the right. \\ \\
Suppose for each $(i, j)$ we construct a matrix $A$ such that $A(k, l) = \text{max} \ P(x_{\text{lhs}} \text{ aligns to } x_{\text{rhs}})$.
Then take:
\[
A(k, l) = \mbox{max}
  \begin{dcases}
  A(k-1, l-1) P(X'[\sigma x_k] \rightarrow X'[\sigma]x_l) \ \ \text{ (match/mismatch)}\\
  A(k-1, l) P(X'[\sigma] \rightarrow X'[\sigma]x_l) \ \ \text{ (insertion)}\\
  A(k, l-1) P(X'[\sigma x_k] \rightarrow X'[\sigma])  \ \ \text{ (deletion)}
  \end{dcases}
\]
So that:
\[
f(i, j) = \mathop{\mbox{max}}_{M} \mathop{\mbox{max}}_{k,l} P(R_\text{rep} \Rightarrow x_\text{lhs}) P(M \Rightarrow x_\text{mid}) A(k,l).
\]
\subsubsection {Mutations Only}
The grammar of only pointwise mutations is that the repetitive strings are
necessarily the same length, removing a single degree of freedom and reducing
time complexity to O($N^4$). \\
Let $c = \lfloor \frac{i + j}{2} \rfloor$, and:
\[
 LHS = \prod_{l=i}^{c-k-1}P(X[\sigma] \rightarrow x_l X[\sigma x_l])
\]


\[
 RHS = \prod_{l=i}^{c+k+1}P(X'[\sigma x_l] \rightarrow X'[\sigma]x_l)
\]
then:
\[
 f(i, j) = \mathop{\mbox{max}}_{M} \ \mathop{\mbox{max}}_{0 \le k \le \lfloor \frac{j - i}{2} \rfloor} \ (LHS)C(c-k, k, M)(RHS)P(L \rightarrow R_\text{rep}(M))P(X'[] \rightarrow M)P(X[\sigma] \rightarrow X'[\sigma])  \\
\]
\ \\

\subsection {Improving Efficiency with Constraints (Hints)}

\subsection {Training}
\subsubsection {Pseudocode Implementation}
\bibliographystyle{unsrt}   % this means that the order of references
			    % is dtermined by the order in which the
			    % \cite and \nocite commands appear
\bibliography{/home/msouza/Desktop/Berkeley/Bibliographies/Holmes.bib}
\end{document} 